# 07 RESTful API 설계 - 프론트엔드와 백엔드 간의 소통 언어 구축하기

---

### 1. RESTful API 특징

REST 아키텍처의 제약 조건을 준수하는 웹 서비스 API를 RESTful API라고 한다.

#### 1.1 REST 아키텍처 제약 사항

##### 1. 1. 1 클라이언트-서버

사용자 인터페이스에 대한 관심사를 데이터 저장소의 관심사와 분리하는 것.

프론트엔드는 브라우저 내부에 클라이언트로 존재하며, API를 통해 서버와 통신한다.



#####  1. 1 . 2 무상태성

클라이언트에서 서버로의 각 요청은 서버가 해당 요청을 이해하는데 모든 정보를 포함한다.

서버는 요청의 이해를 위해 저장된 컨텍스트를 이용하지 않는다.

- 연결을 끊는 순간 클라이언트와 서버의 통신이 끝나며 **상태 정보**는 유지하지 않는 특성이 있다.
- 서버 세션에 저장하지 않는다는 개념



##### 1. 1. 3 캐시

요청에 대한 응답에 캐시 가능 불가능을 명시해야 한다.



##### 1. 1 .4 유니폼 인터페이스

URL로 지정된 리소스에 대한 조작을 통일하고 한정된 인터페이스로 수행하는 아키텍쳐 스타일이다

(put,get,update,delete 처리 및 주소를 통한 데이터 조작)



##### 1. 1. 4 계층형 시스템

다중계층으로 구성된 서버는 보안, 로드 밸런싱, 암호화 계층을 추가해 구조상의 유연성을 둘 수 있고, PROXY, 게이트웨이 같은 네트워크 기반의 중간매체를 사용할 수 있게 된다.

---

#### 1.2 RESTful 인터페이스 제약 사항

##### 1. 2. 1 리소스 식별

리소스는  사용자나 문서, 이미지, 작업일 수 있다.

리소스는 URI를 통해 고유하게 식별할 수 있어야 한다.



##### 1. 2. 2 표현을 통한 리소스 조작

JSON이 가장 인기있는 리소스 표현 형식

REST에서 리소스를 조작하는 것은 표준 http 메소드를 활용하여 서버로 보내는것으로, get post put patch delete 메소드를 사용한다.


##### 1. 2. 3 자기 서술 메세지
수신자가 이해하는데 필요한 모든 정보를 포함하는 메시지


##### 1. 2. 4 애플리케이션 상태 엔진으로서의 하이퍼미디어
HATEOAS 또는 하이퍼미디어 제약으로 알려짐

REST 애플리케이션 초기 URI에 접근하면 REST 클라이언트는 필요한 모든 행동과 리소스를 검색하기 위한 링크를 동적으로 제공하는 서버를 활용할 수 있어야 한다.

해당 서버는 하이퍼 링크를 포함하는 텍스트로 응답한다.

---

#### 1.3 RESTful API 특징

##### 1. 3. 1 리소스 중심적
API는 리소스를 중심으로 구성되어야 한다.
리소스 내부 구조는 API를 통해 유출되지 않아야 한다.

##### 1. 3. 2 URI를 통한 식별 가능
리소스는 URI를 통해 식별할 수 있어야 한다.
동사대신 명사 기반

##### 1. 3. 3 버전관리
API의 변경 사항을 관리하는 일반적인 방법은 버전을 관리하는것
버전 관리를 사용하는 것은 기본적으로 처음부터 비즈니스 모델이 발전함에 따라 호환되지 않는 API로 변경될 수 있음을 API 클라이언트의 개발자에게 알릴 수 있는 방법이다.

버전을 관리하는 방법은 두가지가 있다.
1. URI에 버전의 숫자를 포함하는 것.
2. Http헤더의 X-API-Version에 버전 숫자를 추가하는 것.

##### 1. 3. 4 무상태성
공개 API의 경우 요청 인증을 관리하는데 HTTP 세션을 사용하는 것을 피해야 한다.

##### 1. 3. 5 페이징 처리
리소스의 컬렉션을 요청할때 해당 컬렉션의 수천개의 리소스가 존재할 수 있다.
페이징 처리를 통해 일부만 반환하는 것이 효율적이며, db 쿼리를 실행하는데 시간이 적게 들어 처리능력을 절약할 수 있다.

페이징 처리 방식
1. offset 기반
	URI에 매개변수를 전송
	두번 반환하거나 건너 뛸 수 있다.
2. 커서 기반
	offset기반의 단점을 극복
	페이지 사이를 뛰어넘을 수 없다.
	
##### 1. 3. 6 보안
모든 API는 SSL을 사용해야 하며 HTTP 요청은 실패해야 한다.
HTTPS를 사용하라는 의미

인증 방식
1. API 클라이언트가 랜덤으로 생성된 액세스 토큰을 기존 HTTP 기본 인증의 필드값으로 사용하는것.
2. OAuth2 를 지원해 사용자가 API를 통해 데이터에 접근하려는 애플리케이션에 권한을 부여

---

#### 1.4 스프링MVC에서 RESTful API 구현

##### 1. 4. 1 MVC 어노테이션

![image-20211008183223965](C:\Users\박수오\AppData\Roaming\Typora\typora-user-images\image-20211008183223965.png)

수업중에 사용해본 어노테이션이므로 설명은 생략



##### 1. 4. 2 스프링 HATEOAS

HATEOAS의 핵심 아이디어는 하이퍼텍스트를 활용해 링크의 리소스의 상태변화를 진행하는 것

제공하는 주요  기능은 링크의 생성.



##### 1. 4. 3 스프링 REST Docs

RESTful 서비스를 문서화하는데 도움을 준다.

단점으로는 설계단계에서 도움이 되지 않으며, Open API 스펙을 지원하지 않는다.

---

#### 1.5 RESTful API 활용하기

RESTful API는 대게 HTTP를 기반으로 한다.



##### 1. 5. 1 HTTP 클라이언트

프론트엔드는 백엔드가 제공하는 API의 클라이언트다.

Axios를 http 클라이언트로 사용해 해당 api와 상호자굥ㅇ한다.



##### 1. 5. 2 서버 측면에서 활용하기

RESTfull API를 활용하는 또다른 시나리오로, 백엔드가 원격의 API를 호출하는 경우이다.

Apache HttpClient를 통해 호출할 수 있으나 풀필요하게 중복되는 코드가 많다.

Spring의 RestTemplate를 사용할 수 있다.

HTTP 서버와의 통신을 단순화 하고, RESTful 원칙을 강요한다.

---

#### 1.6 RESTful API 테스팅

1. 통합테스트

   서버에 배포된 실행중인 어플리캐이션의 api를 테스트 하는 것으로 테스트 코드는 api의 클라이언트 역할

2. 단위 테스트

   API 핸들러를 분리하는것으로, 의존성을 다루기 위해 mock을 활용한다. api핸들러 로직을 테스트하기 위한 코드를 작성한다.

테스트에 활용되는 라이브러리들

![image-20211008184156057](C:\Users\박수오\AppData\Roaming\Typora\typora-user-images\image-20211008184156057.png)



@RunWith - Junit Runner 실행을 위한 어노테이션, 테스트 클래스 실행에 사용

@WebMvcTest - 스프링 MVC 기반을 자동 설정

@MockBean - 목을 생성하여 테스트 진입점을 지정하는데에 사용된다.

@Test 테스트 케이스로 실행될 수 있음을 알려주는 어노테이션



